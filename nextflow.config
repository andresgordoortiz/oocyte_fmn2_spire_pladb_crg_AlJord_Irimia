// Default configuration
params {
    // Resource defaults
    max_memory = 128.GB
    max_cpus = 32
    max_time = 240.h
}

// Process configuration
process {
    // Default process configuration
    executor = 'slurm'
    queue = 'genoa64'
    clusterOptions = '--qos=pipelines'
    
    // Error handling
    errorStrategy = 'retry'
    maxRetries = 2
    
    // Process labels configuration
    withLabel: process_low {
        cpus = 2
        memory = 4.GB
        time = 1.h
    }
    
    withLabel: process_medium {
        cpus = 4
        memory = 8.GB
        time = 4.h
    }
    
    withLabel: process_high {
        cpus = 8
        memory = 50.GB
        time = 8.h
    }
}

// Singularity configuration
singularity {
    enabled = true
    autoMounts = true
    cacheDir = '/users/aaljord/agordo/.singularity_cache'
}

// Profiles configuration
profiles {
    crg {
        // CRG cluster specific configuration
        process {
            executor = 'slurm'
            queue = 'genoa64'
            clusterOptions = '--qos=pipelines'
            
            // Module loading for CRG
            beforeScript = 'module load Singularity'
        }
        
        singularity {
            enabled = true
            autoMounts = true
            runOptions = '--bind /users:/users --bind /scratch:/scratch'
            cacheDir = '/users/aaljord/agordo/.singularity_cache'
        }
        
        // CRG specific resource limits
        params {
            max_memory = 256.GB
            max_cpus = 64
            max_time = 720.h
        }
    }
    
    local {
        // Local execution profile
        process.executor = 'local'
        singularity.enabled = false
        docker.enabled = false
    }
    
    docker {
        // Docker profile for local testing
        docker.enabled = true
        singularity.enabled = false
        process.executor = 'local'
    }
}

// Execution report configuration
timeline {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_timeline.html"
}

report {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_report.html"
}

trace {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_trace.txt"
}

dag {
    enabled = true
    file = "${params.outdir}/pipeline_info/pipeline_dag.svg"
}

// Manifest
manifest {
    name = 'FMN2/Spire Alternative Splicing Analysis Pipeline'
    author = 'AndrÃ©s Gordo'
    description = 'RNA-Seq analysis pipeline for alternative splicing in FMN2/Spire knockouts using VAST-tools'
    version = '1.0.0'
    nextflowVersion = '>=23.0.0'
}
